tinymce.PluginManager.requireLangPack("uploadimage"),tinymce.create("tinymce.plugins.UploadImage",{UploadImage:function(g,l){function e(){var e=h(),t=[{type:"iframe",url:"javascript:void(0)"},{type:"textbox",name:"file",label:g.translate("Choose an image"),subtype:"file"},{type:"textbox",name:"alt",label:g.translate("Image description")}];0<e.length&&(b=e[0].value,t=t.concat([{type:"listbox",name:"class",label:g.translate("Class"),values:e,onSelect:function(){b=this.value()}}])),t=t.concat([{type:"container",classes:"error",html:"<p style='color: #b94a48;'>&nbsp;</p>"},{type:"container",classes:"throbber"}]),_=E.windowManager.open({title:g.translate("Insert an image from your computer"),width:520+parseInt(E.getLang("uploadimage.delta_width",0),10),height:180+parseInt(E.getLang("uploadimage.delta_height",0),10),body:t,buttons:[{text:g.translate("Insert"),onclick:d,subtype:"primary"},{text:g.translate("Cancel"),onclick:g.windowManager.close}]},{plugin_url:l}),v=_.find("iframe")[0],y=s("form",{action:g.getParam("uploadimage_form_url","/tinymce_assets"),target:v._id,method:"POST",enctype:"multipart/form-data",accept_charset:"UTF-8"}),v.getEl().name=v._id,y.appendChild(s("input",{type:"hidden",name:"utf8",value:"\u2713"})),y.appendChild(s("input",{type:"hidden",name:"authenticity_token",value:f("csrf-token")})),y.appendChild(s("input",{type:"hidden",name:m(),value:u()}));for(var a=_.getEl(),n=(t=document.getElementById(a.id+"-body")).getElementsByClassName("mce-container"),i=0;i<n.length;i++)y.appendChild(n[i]);var r=y.getElementsByTagName("input");for(i=0;i<r.length;i++){var o=r[i];"input"===o.tagName.toLowerCase()&&"hidden"!==o.type&&("file"===o.type?(o.name=c("file"),tinymce.DOM.setStyles(o,{border:0,boxShadow:"none",webkitBoxShadow:"none"})):o.name=c("alt"))}t.appendChild(y)}function m(){return c(g.getParam("uploadimage_hint_key","hint"))}function u(){return g.getParam("uploadimage_hint","")}function c(e){return g.getParam("uploadimage_model",!1)?g.getParam("uploadimage_model")+"["+e+"]":e}function d(){if(""===p(c("file")))return i("You must choose a file");(o=new top.tinymce.ui.Throbber(_.getEl())).show(),a();var e=v.getEl();e.attachEvent?(e.detachEvent("onload",t),e.attachEvent("onload",t)):(e.removeEventListener("load",t),e.addEventListener("load",t,!1)),y.submit()}function t(){o&&o.hide();try{var e=v.getEl();if(e.document||e.contentDocument){var t=e.contentDocument||e.contentWindow.document;-1<String(t.contentType).indexOf("html")?n(t.getElementsByTagName("body")[0].innerHTML):n(t.getElementsByTagName("pre")[0].innerHTML)}}catch(a){i("Didn't get a response from the server")}}function n(e){try{var t=tinymce.util.JSON.parse(e);t.error?i(t.error.message):(g.execCommand("mceInsertContent",!1,r(t)),g.windowManager.close())}catch(a){i("Got a bad response from the server")}}function a(){var e=_.find(".error")[0].getEl();e&&(e.getElementsByTagName("p")[0].innerHTML="&nbsp;")}function i(e){var t=_.find(".error")[0].getEl();t&&(t.getElementsByTagName("p")[0].innerHTML=g.translate(e))}function s(e,t){var a=document.createElement(e);for(var n in t)t[n]instanceof Function||(a[n]=t[n]);return a}function r(e){var t=e[g.getParam("uploadimage_model","image")],a=g.getParam("uploadimage_default_img_class",""),n=g.getParam("uploadimage_figure",!1),i=p(c("alt")),r="<img src='"+t.url+"'";if(""!==a&&(r+=" class='"+a+" "+b+"'"),t.height&&(r+=" height='"+t.height+"'"),t.width&&(r+=" width='"+t.width+"'"),r+=" alt='"+i+"'/>",n){var o=g.getParam("uploadimage_figure_class","figure"),l=g.getParam("uploadimage_figcaption_class","figcaption"),m="<figure";return""!==o&&(m+=" class='"+o+"'"),m+=">"+r,m+="<figcaption",""!==l&&(m+=" class='"+l+"'"),m+=">"+i+"</figcaption>",m+="</figure>"}return r}function p(e){var t=y.getElementsByTagName("input");for(var a in t)if(t[a].name===e)return t[a].value;return""}function f(e){var t=document.getElementsByTagName("meta");for(var a in t)if(t[a].name===e)return t[a].content;return null}function h(){for(var e=g.getParam("image_class_list",[]),t=[],a=0;a<e.length;a++)t[a]={text:e[a].title,value:e[a].value};return t}var y,v,_,o,b="",E=g;E.getParam("uploadimage",!0)&&(E.addButton("uploadimage",{tooltip:g.translate("Insert an image from your computer"),icon:"image",onclick:e}),E.addMenuItem("uploadimage",{text:g.translate("Insert an image from your computer"),icon:"image",context:"insert",onclick:e}))}}),tinymce.PluginManager.add("uploadimage",tinymce.plugins.UploadImage);
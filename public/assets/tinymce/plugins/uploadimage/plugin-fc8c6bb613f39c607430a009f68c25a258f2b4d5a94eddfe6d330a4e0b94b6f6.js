tinymce.PluginManager.requireLangPack("uploadimage"),tinymce.create("tinymce.plugins.UploadImage",{UploadImage:function(l,o){function e(){(p=h.windowManager.open({title:l.translate("Insert an image from your computer"),width:520+parseInt(h.getLang("uploadimage.delta_width",0),10),height:180+parseInt(h.getLang("uploadimage.delta_height",0),10),body:[{type:"iframe",url:"javascript:void(0)"},{type:"textbox",name:"file",label:l.translate("Choose an image"),subtype:"file"},{type:"textbox",name:"alt",label:l.translate("Image description")},{type:"container",classes:"error",html:"<p style='color: #b94a48;'>&nbsp;</p>"},{type:"container",classes:"throbber"}],buttons:[{text:l.translate("Insert"),onclick:m,subtype:"primary"},{text:l.translate("Cancel"),onclick:l.windowManager.close}]},{plugin_url:o})).off("submit"),p.on("submit",m),s=p.find("iframe")[0],d=g("form",{action:l.getParam("uploadimage_form_url","/tinymce_assets"),target:s._id,method:"POST",enctype:"multipart/form-data",accept_charset:"UTF-8"}),s.getEl().name=s._id,d.appendChild(g("input",{type:"hidden",name:"utf8",value:"\u2713"})),d.appendChild(g("input",{type:"hidden",name:"authenticity_token",value:u("csrf-token")})),d.appendChild(g("input",{type:"hidden",name:"hint",value:l.getParam("uploadimage_hint","")}));for(var e=p.getEl(),t=document.getElementById(e.id+"-body"),a=t.getElementsByClassName("mce-container"),n=0;n<a.length;n++)d.appendChild(a[n]);var i=d.getElementsByTagName("input");for(n=0;n<i.length;n++){var r=i[n];"input"==r.tagName.toLowerCase()&&"hidden"!=r.type&&("file"==r.type?(r.name="file",tinymce.DOM.setStyles(r,{border:0,boxShadow:"none",webkitBoxShadow:"none"})):r.name="alt")}t.appendChild(d)}function m(){if(""==c("file"))return i("You must choose a file");(f=new top.tinymce.ui.Throbber(p.getEl())).show(),n();var e=s.getEl();e.attachEvent?(e.detachEvent("onload",t),e.attachEvent("onload",t)):(e.removeEventListener("load",t),e.addEventListener("load",t,!1)),d.submit()}function t(){f&&f.hide();var e=s.getEl();e.document||e.contentDocument?a((e.contentDocument||e.contentWindow.document).getElementsByTagName("body")[0].innerHTML):i("Didn't get a response from the server")}function a(e){try{var t=tinymce.util.JSON.parse(e);t.error?i(t.error.message):(l.execCommand("mceInsertContent",!1,r(t)),l.windowManager.close())}catch(a){i("Got a bad response from the server")}}function n(){var e=p.find(".error")[0].getEl();e&&(e.getElementsByTagName("p")[0].innerHTML="&nbsp;")}function i(e){var t=p.find(".error")[0].getEl();t&&(t.getElementsByTagName("p")[0].innerHTML=l.translate(e))}function g(e,t){var a=document.createElement(e);for(var n in t)t[n]instanceof Function||(a[n]=t[n]);return a}function r(e){var t=l.getParam("uploadimage_default_img_class",""),a=l.getParam("uploadimage_figure",!1),n=c("alt"),i="<img src='"+e.image.url+"'";if(""!=t&&(i+=" class='"+t+"'"),e.image.height&&(i+=" height='"+e.image.height+"'"),e.image.width&&(i+=" width='"+e.image.width+"'"),i+=" alt='"+n+"'/>",a){var r=l.getParam("uploadimage_figure_class","figure"),o=l.getParam("uploadimage_figcaption_class","figcaption"),m="<figure";return""!==r&&(m+=" class='"+r+"'"),m+=">"+i,m+="<figcaption",""!=o&&(m+=" class='"+o+"'"),m+=">"+n+"</figcaption>",m+="</figure>"}return i}function c(e){var t=d.getElementsByTagName("input");for(var a in t)if(t[a].name==e)return t[a].value;return""}function u(e){var t=document.getElementsByTagName("meta");for(var a in t)if(t[a].name==e)return t[a].content;return null}var d,s,p,f,h=l;h.addButton("uploadimage",{tooltip:l.translate("Insert an image from your computer"),icon:"image",onclick:e}),h.addMenuItem("uploadimage",{text:l.translate("Insert an image from your computer"),icon:"image",context:"insert",onclick:e})}}),tinymce.PluginManager.add("uploadimage",tinymce.plugins.UploadImage);